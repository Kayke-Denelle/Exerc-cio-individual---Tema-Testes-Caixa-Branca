import{y as m,au as a,j as o}from"./app-2NaTuxnu.js";import{D as r}from"./constants-BAQss29X.js";import{w as u}from"./wrapper-D6kMfi6x.js";function f(t){return console.log("type:",t),t?t.match(/(LOB|BINARY|geomcollection|POINT|GEOMETRY|LINESTRING|POLYGON)/i)==null:!1}function R(t){return t.filter(e=>f(e.type)||e.type.match(/(JSON)/i)==null)}function v(t,e){if(!e)return null;switch(t){case r.MYSQL:case r.MARIA_DB:const{columnType:i,columnLength:l,flags:b}=e;return s[i]=="blob"&&b==16?l==1020?"TINYTEXT":"text":s[i];case r.PG:case r.REDSHIFT:return c[e.dataTypeID];default:return e.type}}var c=(t=>(t[t.bool=16]="bool",t[t.bytea=17]="bytea",t[t.char=18]="char",t[t.bigint=20]="bigint",t[t.smallint=21]="smallint",t[t.integer=23]="integer",t[t.regproc=24]="regproc",t[t.text=25]="text",t[t.oid=26]="oid",t[t.tid=27]="tid",t[t.xid=28]="xid",t[t.cid=29]="cid",t[t.json=114]="json",t[t.xml=142]="xml",t[t.pg_node_tree=194]="pg_node_tree",t[t.smgr=210]="smgr",t[t.path=602]="path",t[t.polygon=604]="polygon",t[t.cidr=650]="cidr",t[t.real=700]="real",t[t["double precision"]=701]="double precision",t[t.abstime=702]="abstime",t[t.reltime=703]="reltime",t[t.tinterval=704]="tinterval",t[t.circle=718]="circle",t[t.macaddr8=774]="macaddr8",t[t.money=790]="money",t[t.macaddr=829]="macaddr",t[t.inet=869]="inet",t[t.aclitem=1033]="aclitem",t[t.character=1042]="character",t[t.varchar=1043]="varchar",t[t.date=1082]="date",t[t.time=1083]="time",t[t.timestamp=1114]="timestamp",t[t.timestamptz=1184]="timestamptz",t[t.interval=1186]="interval",t[t.timetz=1266]="timetz",t[t.bit=1560]="bit",t[t.varbit=1562]="varbit",t[t.numeric=1700]="numeric",t[t.refcursor=1790]="refcursor",t[t.regprocedure=2202]="regprocedure",t[t.regoper=2203]="regoper",t[t.regoperator=2204]="regoperator",t[t.regclass=2205]="regclass",t[t.regtype=2206]="regtype",t[t.uuid=2950]="uuid",t[t.txid_snapshot=2970]="txid_snapshot",t[t.pg_lsn=3220]="pg_lsn",t[t.pg_ndistinct=3361]="pg_ndistinct",t[t.pg_dependencies=3402]="pg_dependencies",t[t.tsvector=3614]="tsvector",t[t.tsquery=3615]="tsquery",t[t.gtsvector=3642]="gtsvector",t[t.regconfig=3734]="regconfig",t[t.regdictionary=3769]="regdictionary",t[t.jsonb=3802]="jsonb",t[t.regnamespace=4089]="regnamespace",t[t.regrole=4096]="regrole",t))(c||{}),s=(t=>(t[t.decimal=0]="decimal",t[t.tinyint=1]="tinyint",t[t.smallint=2]="smallint",t[t.int=3]="int",t[t.float=4]="float",t[t.double=5]="double",t[t.null=6]="null",t[t.timestamp=7]="timestamp",t[t.bigint=8]="bigint",t[t.int24=9]="int24",t[t.date=10]="date",t[t.time=11]="time",t[t.datetime=12]="datetime",t[t.year=13]="year",t[t.newdate=14]="newdate",t[t.bit=16]="bit",t[t.timestamp2=17]="timestamp2",t[t.datetime2=18]="datetime2",t[t.time2=19]="time2",t[t.json=245]="json",t[t.newdecimal=246]="newdecimal",t[t.enum=247]="enum",t[t.set=248]="set",t[t.tiny_blob=249]="tiny_blob",t[t.medium_blob=250]="medium_blob",t[t.long_blob=251]="long_blob",t[t.blob=252]="blob",t[t.varchar=253]="varchar",t[t.string=254]="string",t[t.geometry=255]="geometry",t))(s||{});const h=m("result",{state:()=>({data:[],backupData:[],isArrayResult:!1,fields:[],dbType:null,costTime:0,sql:"",transId:null,hasTruncate:!1,readonly:!1,reverseData:!1,columnList:null,columnTypeMap:null,database:null,table:null,withDot:null,tableCount:null,pageNum:null,pageSize:null}),getters:{noTable(t){return t.tableCount!=1},primaryKeyList(t){var e;return[r.ES,r.MONGO_DB].includes(t.dbType)?[{name:"_id",type:"text"}]:(e=t.columnList)==null?void 0:e.filter(i=>i.isPrimary)},hasPK(){var t;return(t=this.primaryKeyList)==null?void 0:t.length}},actions:{getTypeByField(t){var e,i;return this.dbType==r.ES&&t.name=="_id"?"text":((i=(e=this.columnTypeMap)==null?void 0:e[t.name])==null?void 0:i.type)??v(this.dbType,t)}}});function N(t,e){return t?h().withDot?u(t,e):t.split(".").map(l=>u(l,e)).join("."):null}class w{constructor(){this.commands=[],this.index=0}push(e){this.commands.push(e),this.index=this.commands.length-1}previous(){if(this.commands.length!=0){if(this.index--<0){this.index=0;return}return this.commands[this.index]}}next(){if(this.commands.length!=0){if(this.index++>=this.commands.length){this.index=this.commands.length-1;return}return this.commands[this.index]}}}const n=h(),q=m("UI",{state:()=>({showSQLPanel:!1,history:new w,state:{...a},user:null,viewColumn:2,viewType:"Default",info:{sql:null,message:null,error:!1},tableStatus:{remainHeight:0,doNotClear:!1,loadingTimeout:null,rawColumnWidth:500},table:{search:"",loading:!1,start:new Date().getTime(),loadingTimer:null,widthItem:{},sort:{ascIndex:null,descIndex:null},sortKeys:[],expandKeys:[],selectedRows:[],selectedRowKeys:[]},page:{pageNum:1,pageSize:-1,total:0},dialog:{importVisible:!1,exportVisible:!1,detailScope:null,detailVisible:!1},toolbar:{sql:null,showSaveBtn:!1,saveLoading:!1,filter:{},showColumns:[]},deleteConfirm:{sql:"",visible:!1,skipForeignCheck:!1}}),getters:{hasResult(){var t;return((t=n.fields)==null?void 0:t.length)>0},notAllowUpdate(){return n.tableCount!=1||n.readonly||!this.hasResult},notAllowUpdateLevel2(){return this.notAllowUpdate||this.reverseData},isSplitView(){return this.viewColumn>=2},reverseData(){return this.viewType=="Reverse"}},actions:{checkShowSQLPanel(){var t,e,i;if(this.isSplitView&&([r.ES].includes(n.dbType)||window.innerHeight<500||((i=(e=(t=this.toolbar)==null?void 0:t.sql)==null?void 0:e.match(/\n/g))==null?void 0:i.length)>1))return this.showSQLPanel=!1;this.showSQLPanel=!0},resetConfig(){this.viewType="Default";for(const t of Object.keys(a))t!="resetFilter"&&(this.state[t]=a[t],o.emit("upState",{key:t,value:a[t],ignore:!0}));document.querySelector(".codemirror-container").style.height="40px"},closeConfig(){o.emitImmediately("closeConfig")},refresh(){this.execute(n.sql)},execute(t,e={}){t&&(o.emit("executeSQL",{sql:t,...e}),this.table.start=new Date().getTime(),this.queueLoading())},queueLoading(){this.tableStatus.doNotClear||(this.info.message=null),clearTimeout(this.tableStatus.loadingTimeout),this.tableStatus.loadingTimeout=setTimeout(()=>{this.table.loading=!0,n.costTime=0,clearInterval(this.table.loadingTimer),this.table.loadingTimer=setInterval(()=>{n.costTime=new Date().getTime()-this.table.start},79)},100)}}});export{h as a,R as g,q as u,N as w};
